image: maven:3.8.5-openjdk-17

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
  IMAGE_TAG: "$CI_COMMIT_SHORT_SHA"

workflow:
  rules:
    - if: "$CI_COMMIT_TAG"
      variables:
        IMAGE_TAG: "release-$CI_COMMIT_TAG"
    - if: $CI_COMMIT_BRANCH == "main"
    - when: always

cache:
  paths:
    - .m2/repository

stages:
  - build

maven-compile:
  stage: build
  script:
    - 'mvn clean compile'
  artifacts:
    paths:
      - target/classes/
      - target/generated-sources/
    expire_in: 1 day